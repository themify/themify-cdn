(($,E,N,L)=>{"use strict";const S=builderMosaicAdmin,O=window.top,s=L.createElement("style"),l={};N.jsModuleLoaded().then(()=>{let C=!1;const j=(t,a)=>{const i=".grid-stack .grid-stack-item";if(void 0===l["l"+t]){l["l"+t]=!0;let e=8.333*t;t%3==0&&(e=Math.round(e)),s.textContent+=i+'[data-gs-x="'+t+'"]{left:'+e+"%}"}if(void 0===l["w"+a]){l["w"+a]=!0;let e=8.333*a;a%3==0&&(e=Math.round(e)),s.textContent+=i+'[data-gs-width="'+a+'"]{width:'+e+"%}"}};ThemifyConstructor.ptb_mosaic_group={render(e,t){e.wrap_class="ptb_mosaic_options";const a=t.create(e.options,t);return a.tfOn(E.click,e=>{e.target.classList.contains("mosaic_ptb_field_group")&&$(e.target).toggleClass("expanded").nextUntil(".mosaic_ptb_field_group").toggle(e.target.classList.contains("expanded"))},{passive:!0})}},ThemifyConstructor.tile_grid={render(l,n){let r=!1,o=null,d=null,c=E.click,p=()=>{const a=[],i=O.document.tfClass("grid-stack-item");for(let t=0,e=i.length;t<e;++t)if(null!==i[t].offsetParent){let e=O.jQuery(i[t]).data("_gridstack_node");a.push({x:e.x,y:e.y,width:e.width,height:e.height})}return JSON.stringify(a)},g=(i,e)=>{r=!1,(e=void 0===e?!0:e)&&o.removeAll();for(let a in i="string"==typeof i?JSON.parse(i):i){let e=L.createElement("div"),t=L.createElement("div");e.className="grid-stack-item-content",t.appendChild(e),o.addWidget(t,i[a]),j(i[a].x,i[a].width)}r=!0,e&&d.triggerHandler("change.tile_grid_change")};const e=L.createElement("div"),t=L.createElement("div"),a=L.createElement("div"),i=L.createElement("span"),s=L.createElement("div"),m=L.createElement("div"),u=L.createElement("a"),h=n.hidden.render({id:l.id,class:"builder_tile_grid_template",type:"hidden",control:{control_type:"change"}},n),_=L.createElement("div"),f=L.createElement("div"),v=L.createElement("div"),b=L.createElement("a"),y=L.createElement("a"),k=n.select.render({id:"layout"},n),w=k.querySelector("select");e.className="builder_tile_grid",t.id="mosaic-presets",a.className="load-template",i.className="template-grid-icon",s.className="load-template-panel",m.className="presets",_.id="tile-grid-editor",f.className="grid-stack",u.href="#",u.id="tftp-save-preset",u.dataset.prompt=S.labels.name,u.textContent=S.labels.save,v.className="builder_grid_actions",b.className="tb_builder_add_tile",b.textContent=S.labels.add,y.className="tb_builder_remove_tile",y.textContent=S.labels.remove;for(let t in l.options){let e=L.createElement("a");e.className="tb_mosaic_preset",e.width=e.height=70,e.dataset.index=t,e.dataset.template=l.options[t].template,m.appendChild(e)}s.append(m,L.createTextNode(S.labels.custom),L.createElement("br"),k),i.append(N.Helper.getIcon("ti-layout-column3"),L.createTextNode(S.labels.template),N.Helper.getIcon("ti-angle-down")),a.append(s,i),t.append(u,a),_.appendChild(f),v.append(b,y),e.append(t,h,_,v),b.tfOn(c,e=>{e.preventDefault(),e.stopPropagation();const t=L.createElement("div"),a=L.createElement("div"),i=(t.className="grid-stack-item-content",a.appendChild(t),o.addWidget(a,{x:void 0,y:void 0,width:3,height:2,autoPosition:!0}));j(i.dataset.gsX,i.dataset.gsWidth),d.triggerHandler("change.tile_grid_change")}),y.tfOn(c,e=>{e.preventDefault(),e.stopPropagation();const t=d.find(".selected");0<t.length&&o.removeWidget(t),d.triggerHandler("change.tile_grid_change")}),w.tfOn("change",function(e){const t=this.value;"object"==typeof S.presets[t]&&g(S.presets[t].content)},{passive:!0}),m.tfOn(c,e=>{e.preventDefault(),e.stopPropagation(),e.target.classList.contains("tb_mosaic_preset")&&g(e.target.dataset.template)});const x=a=>{if("object"==typeof S.presets){const i=L.createDocumentFragment();i.appendChild(L.createElement("option"));for(let t in S.presets){let e=L.createElement("option");e.value=t,e.textContent=S.presets[t].title,void 0!==a&&t===a.layout&&(e.selected=!0),i.appendChild(e)}w.innerHTML="",w.appendChild(i)}};return u.tfOn(c,function(e){e.preventDefault(),e.stopPropagation(),0!==d.length&&N.LiteLightBox.prompt(this.dataset.prompt,N.LightBox.el.querySelector("#mod_title").value).then(e=>{if("yes"===e[0]){const t=p(),a=e[1].trim();N.Spinner.showLoader(),N.LocalFetch({action:"builder_tiled_posts_save_preset",name:a,grid:t},"text").then(e=>{S.presets[e]={title:a,content:t},x({layout:e})}).finally(()=>{N.Spinner.showLoader("spinhide")})}}).catch(e=>{})}),(async()=>{if(!0!==C){const e=S.jqui,t=themify_vars.wp,a="1.1.2",i=[],s={[e+"core.min.js"]:{test:!!O.jQuery.ui,v:t},[e+"widget.min.js"]:{test:!(!O.jQuery.widget&&S.ui_widget),v:t},[e+"mouse.min.js"]:{test:!!O.jQuery.fn.mouse,v:t},[e+"draggable.min.js"]:{test:!!O.jQuery.fn.draggable,v:t},[e+"droppable.min.js"]:{test:!!O.jQuery.fn.droppable,v:t},[e+"resizable.min.js"]:{test:!!O.jQuery.fn.resizable,v:t},[S.path+"assets/gridstack.js"]:{test:!!O.GridStack,v:a},[S.path+"assets/gridstack.jQueryUI.js"]:{test:!!O.$Grid,v:a}},l=Object.keys(s);for(let t=0,e=l.length;t<e;++t){let e=s[l[t]];i.push(O.Themify.loadJs(l[t],e.test,e.v,!1,!1))}await Promise.all(i),C=!0}})().then(()=>{let s=N.LightBox.el;d=$(".grid-stack",s),o=new O.GridStack.init({float:!1,rtl:E.isRTL,resizable:{handles:"e, se, s, sw, w"},disableDrag:!1,disableResize:!1},d[0]),d.on(c,".grid-stack-item",function(){$(this).siblings().removeClass("selected").end().addClass("selected")}),d.on("change.tile_grid_change",(e,t)=>{r&&(h.value=p(),E.triggerEvent(h,"change"))}),o.on("change",(e,t)=>{for(let e=t.length-1;-1<e;--e)j(t[e].x,t[e].width)}),void 0!==n.values.template&&g(n.values.template,!1),$("#tiled_posts_display",s).trigger("change.tiled_posts_display"),x(l);const a=()=>{const e=s.querySelector("#post_type_ptb");if(e){const t=e.tfTag("input"),a=s.querySelectorAll(".ptb_mosaic_options > .tb_field_group"),i=t=>{for(let e=a.length-1;-1<e;--e)a[e].style.display=a[e].classList.contains("group_"+t)?"block":"none"};for(let e=0;e<t.length;e++)t[e].tfOn("change",function(){i(this.value)});i(e.querySelector("input:checked").value)}},e=s.querySelector("#tiled_posts_display"),i=s.querySelectorAll(".tb_mosaic_tabs > .tb_field_group"),t=t=>{if(void 0!==t)for(let e=i.length-1;-1<e;--e)i[e].style.display=i[e].classList.contains("group_"+t)?"block":"none","ptb"===t&&a()};e.tfOn("change",function(){t(this.value)}),t(n.values[e.id]),E.on("themify_builder_lightbox_close",()=>{d&&d.off("change"),o=d=c=s=null},!0)}),e}}}),E.on("themify_builder_ready",()=>{E.requestIdleCallback(()=>{s.textContent=".grid-stack .grid-stack-item{position:absolute;left:0;top:0;padding:0}.grid-stack.grid-stack-1{width:auto;margin-left:0;height:auto!important}.grid-stack.grid-stack-1 .builder_mosaic_item.grid-stack-item{position:relative;top:0;left:0;width:auto;margin-bottom:20px}",O.document.head.appendChild(s),O.Themify.loadCss(S.admin_css,null,S.v)},800)},!0,N.is_builder_ready)})(jQuery,Themify,tb_app,document);