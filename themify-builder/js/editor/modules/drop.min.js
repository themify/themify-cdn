((N,R,n)=>{"use strict";N.Drop={async row(e,o,t,l){const i=async l=>{const i=n.createDocumentFragment(),s=[],r=[],a=null===e.closest(".tb_holder");for(let t=0,e=l.length;t<e;++t){let e=new(!0==a?N.Row:N.Subrow)(l[t]);if(i.appendChild(e.el),s.push(e),"visual"===N.mode&&"grid"!==o){let t=e.el.querySelectorAll("[data-cid]");r.push(e.id);for(let e=t.length-1;-1<e;--e)r.push(t[e].dataset.cid);e.el.style.visibility="hidden"}}if(e.replaceWith(i),N.Builder.get().removeLayoutButton(),"visual"===N.mode&&await N.bootstrap(r),"pagebreak"!==o){await N.correctColumnPaddings();for(let e=0,t=s.length;e<t;++e)N.Utils.setCompactMode(s[e].el.tfClass("module_column")),N.Utils.runJs(s[e].el),s[e].el.style.visibility=""}else N.pageBreakModule.countModules();"grid"!==o&&"pagebreak"!==o&&N.Spinner.showLoader("done")};if(!1!==l&&N.Utils.scrollTo(e),"library"===o||"predesign"===o){const s="library"===o?await this.Library.row(t):await N.preDesignedRows.get(t);await i(s)}else if("pagebreak"===o)await i(N.pageBreakModule.get());else{if("grid"!==o)throw"";await i(N.Utils.grid(t))}},async column(i,e,g){const s=i.parentNode,l=!e,r=!s,o=!0==r?null:N.Registry.get(s.closest("[data-cid]").dataset.cid),n=e?e.parentNode:s,f=N.Registry.get(n.closest("[data-cid]").dataset.cid),T=f.get("sizes"),d=o?o.get("sizes"):{},t="left"!==g&&e?e.nextElementSibling:e,u=getComputedStyle(i).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim();if(s!==n){n.insertBefore(i,t);const a=n.classList.contains("subrow_inner");if(i.classList.toggle("sub_column",a),i.classList.toggle("tb-column",!a),s&&!s.firstChild){const _=new N.Column({grid_class:"col-full"},s.classList.contains("subrow_inner"));s.appendChild(_.el)}}else!0==l&&i.remove();const m=N.activeBreakPoint,c=n.childElementCount,p=s?s.childElementCount:0,y=getComputedStyle(n),h=N.breakpointsReverse,U=!1==l&&e?getComputedStyle(e).getPropertyValue("grid-area").split("/")[0].replaceAll('"',"").trim():null,w=e=>{if(-1===e.indexOf(" "))return y.getPropertyValue("--c"+e);if(-1!==(e=e.replace(/\s\s+/g," ").trim()).indexOf("repeat")){if(-1!==e.indexOf("auto-fit")||-1!==e.indexOf("auto-fill"))return"";{let s="",r=e.replace(/\s\,\s|\s\,|\,\s/g,",").replace(/\s\(\s|\s\(|\(\s/g,"(").replaceAll(" )",")").trim().split(" ");for(let i=0,e=r.length;i<e;++i)if(-1!==r[i].indexOf("repeat")){let e=r[i].split("(")[1].replace(")","").split(","),t=parseInt(e[0]),l=e[1].trim();isNaN(t)&&(l="1fr",t=childCount),s+=" "+(" "+l).repeat(t)}else s+=" "+r[i];e=s.trim()}}return e},C=(e,l)=>{const i=l.length,t=N.getColClass(),s=N.getColClassValues(),r=e&&-1===e.indexOf(" ")&&void 0!==t[e]?t[e]:t[i],a=s.length-1;for(let e=i-1;-1<e;--e){let t=l[e].classList;for(let e=a;-1<e;--e)t.remove(s[e]);void 0!==r&&i<7&&t.add(r[e]),t.remove("first","last")}1<i&&(l[0].classList.add("first"),l[i-1].classList.add("last"))};if(s===n&&!1==l&&!1==r)if("desktop"===m){const b={},z={},v=y.getPropertyValue("--area").replaceAll('"',"").trim().split(" "),x=s.children,L=x.length;s.classList.remove("direction_rtl"),o.setSizes({dir:""});for(let t=L-1;-1<t;--t){let e=x[t].dataset.cid;e&&(b[e]=t+1)}let e=y.getPropertyValue("--col");if(s.insertBefore(i,t),e&&"unset"!==e&&"initial"!==e&&"none"!==e&&-1===e.indexOf("repeat")){const S=v.indexOf(u),O=getComputedStyle(i).getPropertyValue("grid-area").split("/")[0].replaceAll('"',"").trim(),A=v.indexOf(O),P=(e=e.split(" "))[A];e[A]=e[S],e[S]=P,o.setCols({size:e.join(" ")},m)}for(let t=L-1;-1<t;--t){let e=x[t].dataset.cid;e&&(z[e]=t+1)}for(let l=h.length-2;-1<l;--l){let e=h[l],t=d[e+"_area"];if(t){-1===t.indexOf('"')&&(t=y.getPropertyValue("--area"+t).replace(/\s\s+/g," ").trim());for(let e in z)b[e]!==z[e]&&(t=t.replaceAll(b[e]+" ","#"+z[e]+"# ").replaceAll(b[e]+'"',"#"+z[e]+'#"'));o.setCols({area:t.replaceAll("#","")},e)}}C(e,x)}else{let s=y.getPropertyValue("--area").replace(/  +/g," ").trim(),l=y.getPropertyValue("--col"),e="right"===g?1:0,t="left",i,r=s.split('" "')[0].split(" ").length,a=(s=s.replaceAll('"',"").trim().split(" ")).indexOf(U),o=s.indexOf(u),n=o,d=R.convert(s),c=s.length,p=[];if(n<a&&(t="right",e="right"===g?0:-1,n=s.lastIndexOf(u)),a+=e,i=s[a],"left"===t)for(let i=n-1;i>=a;--i){let t=s[i],l=s[i+1];if(t!==l)for(let e=i;e<c;++e)s[e]===l&&(s[e]="_"+t)}else for(let i=n+1;i<=a;++i){let t=s[i],l=s[i-1];if(t!==l)for(let e=0;e<i;++e)s[e]===l&&(s[e]="_"+t)}for(let e=c-1;-1<e;--e)"_"===s[e][0]?s[e]=s[e].substring(1):i===s[e]&&(s[e]=u);for(let e=0,t=c/r;e<t;++e)p.push('"'+s.slice(e*r,(e+1)*r).join(" ")+'"');const k={area:p=p.join(" ")};if(l&&"unset"!==l&&"initial"!==l&&"none"!==l){const B=parseInt(o/r),V=p.replaceAll('"',"").trim().split(" ").indexOf(u),I=parseInt(V/r);if(I===B&&(l=w(l))){l=l.split(" ");const G=[],M=p.split('" "')[B].replaceAll('"',"").split(" ");d=d.slice(B*r,B*r+r);for(let t=0,e=M.length;t<e;++t){let e=d.indexOf(M[t]);G[t]=l[e],d.slice(e,1)}k.size=G.join(" ")}}f.setCols(k,m)}else{let a="1fr";if(!1==r){let e={},t={},l=[],r=d.desktop_size,i=parseInt(u.replace("col",""));for(let e=1;e<=p+1;++e)l[e-1]=e;r=r&&"1"!==r&&1!==r?(r=w(r))&&r.split(" "):null;for(let t=l.length-1;-1<t;--t){let e=parseInt(l[t]);e===i?(r&&void 0!==r[t]&&(a=r[t],r.splice(t,1)),l.splice(t,1)):(e>i&&--e,l[t]="col"+e)}if(a&&"1fr"!==a){let i=parseFloat(a),s=0;if(.1<i-1){for(let t=r.length-1;-1<t;--t){let e=parseFloat(r[t]);(1<i&&e<1||i<1&&1<e)&&++s}if(0<s){let l=parseFloat(i/s);i<1&&(l*=-1);for(let t=r.length-1;-1<t;--t){let e=parseFloat(r[t]);(1<i&&e<1||i<1&&1<e)&&(r[t]=e+l+"fr")}}}}C(r=1!==p&&r?ThemifyStyles.getColSize(r.join(" "),!1):null,s.children),1===p?(l=null,t.gutter=e["--area"]=e["--colg"]=""):l='"'+l.join(" ")+'"',t.area=l,t.size=r,o.setCols(t),r||(e["--col"]=""),o.setGridCss(e),s.classList.remove("tb_col_count_"+(p+1)),s.classList.add("tb_col_count_"+p)}if(!1==l){let t=[],e={},l=T.desktop_size;for(let e=1;e<c+1;++e)t[e-1]="col"+e;if(l=l||"1fr"===a?l:"1fr ".repeat(c).trim())if(l=w(l)){l=l.split(" ");let e=R.convert(n.children).indexOf(i);l.splice(e,0,a),l=ThemifyStyles.getColSize(l.join(" "),!1)}else l=null;l||(e["--col"]=""),C(l,n.children),t='"'+t.join(" ")+'"',f.setCols({area:t,size:l}),f.setGridCss(e),n.classList.remove("tb_col_count_"+(c-1)),n.classList.add("tb_col_count_"+c),f.setMaxGutter()}const j=new Set;for(let e=h.length-2;-1<e;--e){let t=h[e];if(!1==r){let e=o.getGridCss({size:"auto"},t);"auto"!==o.getSizes("size",t)&&j.add(N.Helper.getBreakpointName(t)),e["--area"]&&-1===e["--area"].indexOf(" ")?o.setCols({size:"auto"},t):(o.setGridCss({"--area":"","--col":""},t),o.setSizes({size:"auto"},t))}if(!1==l){"auto"!==f.getSizes("size",t)&&j.add(N.Helper.getBreakpointName(t));let e=f.getGridCss({size:"auto"},t);e["--area"]&&-1===e["--area"].indexOf(" ")?f.setCols({size:"auto"},t):(f.setGridCss({"--area":"","--col":""},t),f.setSizes({size:"auto"},t)),f.setMaxGutter()}}j.size}N.Utils._onResize(!0)},async module(e,t,l,i){if(!1!==i&&N.Utils.scrollTo(e),"part"!==t&&"module"!==t){const s=N.Module.getDefault(l),r=new N.Module({mod_settings:s,mod_name:l});return r.is_new=!0,e.replaceWith(r.el),r.trigger("edit"),"visual"===N.mode&&"layout-part"!==l&&"overlay-content"!==l&&await r.trigger(r.getPreviewType(),s),r}await this.Library.module(e,t,l)},Library:{async row(e){let t=await N.Library.get(e,"row");if(!Array.isArray(t)){t=new Array(t);const l=N.GS.findUsedItems(t);!1!==l&&l.length&&(t[0].used_gs=l)}return t},async module(e,t,l,i){const s=await N.Library.get(l,t),r=new N.Module(s),a=r.get("mod_settings");return"visual"===N.mode&&await N.bootstrap([r.id]),e.replaceWith(r.el),r.is_new=!0,await r.trigger("edit"),await r.trigger(r.getPreviewType(),a),!1!==i&&N.Utils.scrollTo(r.el),N.Builder.get().removeLayoutButton(),r}}}})(tb_app,Themify,document);