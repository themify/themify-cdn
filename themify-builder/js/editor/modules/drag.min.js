(($,W,X,V,j)=>{"use strict";W.Drag=e=>{if(!0!==W.isGSPage){let D;e.tfOn("pointerdown",e=>{1!==e.which||W.isPreview||e.target.closest(".tb_dragger,.tb_disable_sorting,.tb_editor_on")?D=null:(D=e.target).classList.contains("tb_grid_drag")?(D=null,W.columnResize(e)):0===D.tagName.indexOf("TB-")&&(D=e.composedPath()[0]).closest(".tab")&&(D=null)},{passive:!0}).tfOn("dragstart",function(C){if(D&&C.target.nodeType!==Node.TEXT_NODE){let x=C.target.closest("[draggable]");if(!x||"desktop"!==W.activeBreakPoint&&x.classList.contains("active_module"))C.preventDefault(),D=null;else{let y=x.classList,L=y.contains("module_row"),e=L,w=!L&&y.contains("module_column");if(e&&!D.classList.contains("tb_move"))C.preventDefault(),D=null;else{L||w||(L=y.contains("page_break_module")||y.contains("predesigned_row")||y.contains("tb_item_row")),D=null,C.stopImmediatePropagation();let o,s,g=null,p=L?"row":w?"column_move":y.contains("tb_grid")?"column":"module",l=[p],m=j.body,_=0,f=0,u,n,t,a=null,b=null,r,i,h=[W.ToolBar.el.getRootNode().host,V.document.tfId("tb_fixed_bottom_scroll")],d=W.Builder.get().el,c=[V.document.body],v=j.createElement("div");const O=t=>{if(null===b&&a){b=!0;let e="tb_main_toolbar_root"===t||"wpadminbar"===t?"-":"+";e+="="+i*r+"px",a.stop().animate({scrollTop:e},{duration:10,complete(){!0===b&&(b=null,O(t))}})}},S=function(){t&&clearInterval(t),r=5,t=setInterval(()=>{r<51?r+=5:(clearInterval(t),t=null)},1200),(u=null)!==g&&(g.style.display="none");for(let e=d.querySelectorAll("[data-pos]"),t=e.length-1;-1<t;--t)e[t].removeAttribute("data-pos");O(this.id)},P=()=>{t&&clearInterval(t),b=t=null,a.stop()},A=e=>{if(t&&clearInterval(t),!0===e){for(let e=h.length-1;-1<e;--e)h[e].tfOff("dragenter",S,{passive:!0}).tfOff("dragleave",P,{passive:!0});L&&"visual"===W.mode&&W.ToolBar.zoom({item:W.ToolBar.el.querySelector('[data-zoom="100"]')}),h=b=t=r=a=i=null}else if(i=1,"visual"!==W.mode&&((a=(a=W.ToolBar.el.getRootNode().host.closest(".interface-interface-skeleton__content"))||j.tfClass("edit-post-layout__content")[0])?i/=2:a=null),a=null===a?"desktop"===W.activeBreakPoint?$("body,html"):$("body,html",V.document):$(a),L&&"visual"===W.mode&&W.ToolBar.zoom({item:W.ToolBar.el.querySelector('[data-zoom="50"]')}),0<i)for(let e=h.length-1;-1<e;--e)h[e].tfOn("dragenter",S,{passive:!0}).tfOn("dragleave",P,{passive:!0})},F=e=>{e.dataTransfer.dropEffect=e.dataTransfer.effectAllowed="none",u&&u.removeAttribute("data-pos"),null!==g&&(g.style.display="none")},N=e=>{if(e.preventDefault(),e.stopImmediatePropagation(),o&&(o.style.top=e.clientY-s+"px"),!e.target||null!==b||e.target===m||e.target===x||"module"===p&&e.target.classList.contains("module_row"))F(e);else if((null===g||e.target!==g&&!e.target.classList.contains("tb_sortable_placeholder"))&&(e.dataTransfer.effectAllowed="move",0===_||0===f||10<e.clientY-_||10<_-e.clientY||10<e.clientX-f||10<f-e.clientX||e.target!==u)){_=e.clientY,f=e.clientX;let t=e.target;const r=t.getBoundingClientRect();let s=.5<(_-r.top)/r.height?"bottom":"top";if(!0===w){let l,e=t.classList;if(e.contains("row_inner")||e.contains("row_inner"))t=(l=t).tfClass("module_column")[0],s=null;else{if(e.contains("tb_col_side"))s=e[1].replace("tb_col_side_",""),t=t.parentNode;else{if(!e.contains("module_column"))return;s=.5<(f-r.left)/r.width?"right":"left"}l=t.parentNode}let o=l.dataset.dragW,a=t.dataset.dragArea;if(!o||!a){const i=getComputedStyle(l);if(!o){const n=l.closest("[data-cid]");if(!n)return;const d=l.offsetWidth;let e=W.Registry.get(n.dataset.cid).getSizes("gutter"),t=(e=(e=e?ThemifyStyles.getGutterValue(e):"")||i.getPropertyValue("--colg")).replace(parseFloat(e).toString(),"")||"%";e=parseFloat(e),o=0===e?"none":"%"===t?parseFloat(parseFloat(d*e/100).toFixed(2)).toString():"em"===t?e*parseFloat(i.getPropertyValue("font-size")):e,l.dataset.dragW=o;for(let e=l.children,t=e.length-1;-1<t;--t)for(let l=e[t].children,a=l.length-1;-1<a;--a)if(l[a].classList.contains("tb_col_side")){l[a].style.marginLeft=l[a].style.marginRight="";let e=l[a].classList.contains("tb_col_side_right")?"50":"-50",t=(l[a].style.width="none"===o?"":o+"px",l[a].style.transform="none"===o?"translateX("+e+"%)":"",l[a].getBoundingClientRect().left);t<0?l[a].style.marginLeft="10px":t>=j.documentElement.clientWidth&&(l[a].style.marginRight="10px")}}if(!a){if(a=i.getPropertyValue("--area")){for(let t=(a=a.split('" "')).length-1;-1<t;--t){let e=a[t].replaceAll('"',"").split(" ");e=Array.from(new Set(e)),a[t]=e.join(" ")}a='"'+a.join('" "')+'"'}else a="1";l.dataset.dragArea=a}}if(null===s)return;if("1"!==a&&!t.classList.contains("tb_drag_side_column")&&!t.classList.contains("tb_drag_one_column")){const c=getComputedStyle(t).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim();-1===a.indexOf(c+" ")&&-1===a.indexOf(" "+c)?t.classList.add("tb_drag_one_column"):t.classList.add("tb_drag_side_column")}t.classList.contains("tb_drag_one_column")&&(s=.5<(_-r.top)/r.height?"right":"left")}if(t!==h[0]&&t!==h[1]){if(!o&&!1===w){if(t.classList.contains("module_column")){if(!(t=t.tfClass("tb_holder")[0]))return void F(e)}else t.classList.contains("tb_dragger")&&(t=t.parentNode);if(t.classList.contains("tb_holder")&&0<t.childElementCount&&(t="top"===s&&t.firstChild!==x?t.firstChild:t.lastChild)===x)return void F(e)}if(u&&u!==t){if(!1===w){const l="top"===s?t.previousSibling:t.nextElementSibling;if(l===u){const a=l.dataset.pos;if("top"===s&&"bottom"===a||"bottom"===s&&"top"===a)return}}u.removeAttribute("data-pos")}t.dataset.pos!==s&&(t.dataset.pos=s,null!==g)&&(g.style.display="",t.classList.contains("tb_holder")?t.appendChild(g):"top"===s?t.before(g):t.after(g)),u=t}}},T=function(e){e.stopImmediatePropagation(),c.push(W.MainPanel.el),c.push(W.ToolBar.el.getRootNode().host);for(let e=c.length-1;-1<e;--e)c[e].classList.add("tb_start_animate","tb_drag_start","tb_drag_"+l[0]),l[1]&&c[e].classList.add(l[1]);if(W.SmallPanel.hide(),W.ActionBar.clear(),this.classList.add("tb_draggable_item"),!0===w){this.parentNode.classList.add("tb_column_drag_inner");const a=d.querySelectorAll(".row_inner,.subrow_inner");for(let e=a.length-1;-1<e;--e){let t=a[e].children,l=a[e].getBoundingClientRect().width-5;for(let e=t.length-1;-1<e;--e)t[e].offsetWidth+t[e].offsetLeft<l&&t[e].classList.add("tb_hide_drag_col_right")}}A(),o&&(o.style.top=e.clientY+"px")},B=e=>{e.stopImmediatePropagation()},I=e=>{e.target&&(e.preventDefault(),e.stopImmediatePropagation()),n=!0;let t=e.target||e;if(t.classList.contains("module_column")||t.classList.contains("tb_col_side"))t=w?t.closest(".module_column"):t.querySelector("[data-pos]");else if(w){t=null;for(let e=j.tfClass("tb_column_drag_inner"),t=e.length-1;-1<t;--t)e[t].classList.remove("tb_column_drag_inner")}else t.classList.contains("tb_dragger")&&(t=t.closest("[draggable]"));if(!(t=(t===g||t.classList.contains("tb_sortable_placeholder"))&&(t=t.closest(".tb_active_builder").querySelector("[data-pos]")).classList.contains("tb_sortable_placeholder")?t.closest(".tb_holder"):t)||"module"===p&&t.classList.contains("module_row"))x.classList.remove("tb_draggable_item");else{W.ActionBar.clear();const l=x.closest(".module_row"),a=null!==l,o=a?x:x.cloneNode(!0),s=t.dataset.pos,r=e=>{const t=e.closest(".module_row");t&&t.classList.toggle("tb_row_empty",void 0===t.tfClass("active_module")[0])};if(g&&g.remove(),W.undoManager.start("move"),x.classList.remove("tb_draggable_item"),a||(o.style.display="none"),t.classList.contains("tb_holder")?t.appendChild(o):w||("top"===s?t.before(o):t.after(o)),w||a){const i=w?W.Drop.column(o,t,s):Promise.resolve();i.then(()=>{X.trigger("tb_"+p+"_sort",[o]),W.Utils._onResize(!0),r(l),r(t),W.undoManager.end("move")})}else{let e=y.contains("tb_grid")?"grid":y.contains("page_break_module")?"pagebreak":"predesign",t=x.dataset.slug,l="grid"===e?"row":p;x.dataset.type&&(e=x.dataset.type,"row"===l)&&y.contains("library_item")&&(e="library"),W.Drop[l](o,e,t).then(()=>{X.trigger("tb_"+p+"_sort",[o]),r(o),"module"===l&&"part"!==e&&"module"!==e?W.undoManager.clear("move"):W.undoManager.end("move")}).catch(()=>{W.undoManager.clear("move")})}}};if(v.className="tb_sortable_helper tf_box tf_overflow",y.contains("active_subrow")&&l.push("tb_drag_subrow"),e){if(j.body.classList.add("tb_drag_row"),"visual"!==W.mode){o=v.cloneNode(),v.style.opacity=0;const k=x.getBoundingClientRect();o.style.width=k.width+"px",o.style.left=k.left+"px",j.body.appendChild(o),s=o.offsetHeight/2}}else if("module"===p||w)if(w||y.contains("active_subrow"))v.innerHTML=w?"Column":"Subrow";else{let e=x.dataset.slug||W.Registry.get(x.dataset.cid).get("mod_name");if(e&&themifyBuilder.modules[e]){const E=themifyBuilder.modules[e],M=E.icon,q=j.createElement("span");q.textContent=E.name,q.className="tf_vmiddle",M&&v.appendChild(W.Helper.getIcon("ti-"+M)),v.appendChild(q)}}else if("column"===p)v.className+=" "+x.className,v.innerHTML=x.innerHTML;else if("row"===p&&(y.contains("page_break_module")||y.contains("predesigned_row"))){const z=y.contains("page_break_module")?"page_break_title":"predesigned_title";v.textContent=x.tfClass(z)[0].textContent}w||!L&&"visual"===W.mode||((g=j.createElement("div")).className="tb_sortable_placeholder tf_rel tf_w");const R=v.querySelector(".add_module_btn");null!==R&&R.remove(),j.body.appendChild(v),C.dataTransfer.effectAllowed="move",C.dataTransfer.setData("Text","id"),C.dataTransfer.setDragImage(v,v.offsetWidth/2+2,v.offsetHeight/2),x.tfOn("dragend",function(e){if(e.stopImmediatePropagation(),j.body.tfOff("dragover",N),d.tfOff(["dragenter","dragleave","pointermove","pointerover","pointerout","pointerenter","pointerleave","mousemove","mouseover","mouseout","mouseenter","mouseleave"],B,{passive:!0}).tfOff("drop",I,{once:!0}),this.tfOff("drag",T,{once:!0,passive:!0}),!n){const t=d.querySelector("[data-pos]");t&&I(t)}v.remove(),o&&o.remove(),g&&g.remove();for(let e=j.querySelectorAll("[data-drag-w],[data-drag-area],[data-pos]"),t=e.length-1;-1<t;--t)e[t].removeAttribute("data-pos"),e[t].removeAttribute("data-drag-w"),e[t].removeAttribute("data-drag-area");for(let e=j.querySelectorAll(".tb_hide_drag_col_right,.tb_drag_one_column,.tb_drag_side_column,.tb_column_drag_inner"),t=e.length-1;-1<t;--t)e[t].classList.remove("tb_hide_drag_col_right","tb_drag_one_column","tb_drag_side_column","tb_column_drag_inner");if(this.classList.remove("tb_draggable_item","tb_drag_one_column","tb_drag_side_column"),A(!0),"visual"!==W.mode)for(let e=j.tfClass("is-drop-target"),t=e.length-1;-1<t;--t)e[t].classList.remove("is-drop-target");for(let e=c.length-1;-1<e;--e)c[e].classList.remove("tb_start_animate","tb_drag_start","tb_drag_start_"+l[0],"tb_drag_"+l[0]),l[1]&&c[e].classList.remove(l[1]);g=n=D=x=y=u=v=o=s=m=d=f=_=l=p=w=c=null,W.ActionBar.clear()},{once:!0,passive:!0}),"visual"===W.mode&&c.push(m);for(let e=c.length-1;-1<e;--e)c[e].classList.add("tb_drag_start_"+l[0]),l[1]&&c[e].classList.add(l[1]);x.tfOn("drag",T,{once:!0,passive:!0}),j.body.tfOn("dragover",N),d.tfOn("dragenter dragleave",B,{passive:!0}).tfOn("drop",I,{once:!0}),X.isTouch||d.tfOn(["pointermove","pointerover","pointerout","pointerenter","pointerleave","mousemove","mouseover","mouseout","mouseenter","mouseleave"],B,{passive:!0})}}}else C.preventDefault(),D=null})}},W.columnResize=e=>{e.stopPropagation();const t=j.body.classList,l=e.target,o=[],s=[],r=l.parentNode,i=r.parentNode,a=getComputedStyle(i),E=i.childElementCount,M=i.offsetWidth,n=l.classList.contains("tb_drag_right")?"w":"e",d=j.createElement("div"),c=j.createElement("div"),g=getComputedStyle(r).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim(),p=g&&"auto"!==g&&"initial"!==g&&"none"!==g?getComputedStyle(i).getPropertyValue("--area").replace(/  +/g," ").trim().split('" "'):"",m=a.getPropertyValue("column-gap"),_=parseFloat(m)||0;let f=getComputedStyle(i).getPropertyValue("--col").replace(/\s\s+/g," ").trim(),u,b,h=!1,v=e.clientX,y=100,L=0,w=0,x=0;if(X.trigger("disableInline"),"none"===f)f="";else if(-1!==f.indexOf("repeat"))if(-1===f.indexOf("auto-fit")&&-1===f.indexOf("auto-fill")){let o="",s=f.replace(/\s\,\s|\s\,|\,\s/g,",").replace(/\s\(\s|\s\(|\(\s/g,"(").replaceAll(" )",")").trim().split(" ");for(let a=0,e=s.length;a<e;++a)if(-1!==s[a].indexOf("repeat")){let e=s[a].split("(")[1].replace(")","").split(","),t=parseInt(e[0]),l=e[1].trim();isNaN(t)&&(l="1fr",t=E),o+=" "+(" "+l).repeat(t)}else o+=" "+s[a];f=o.trim()}else f="";if(p){let a=0;for(let l=p.length-1;-1<l;--l)if(-1!==p[l].indexOf(g)){let t=p[l].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ");for(let e=t.length-1;-1<e;--e)t[e]===g&&(o.push(e),a=l);if(0<o.length)break}if(0<o.length){const z=Math.min.apply(null,o)-1,D=Math.max.apply(null,o)+1,F=i.children,V="w"==n?D:z,N=p[a].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ")[V]?.trim();if(!N)return;for(let e=p.length-1;-1<e;--e)if(-1!==p[e].indexOf(N)){let t=p[e].replace(/\s\s+/g," ").replaceAll('"',"").trim().split(" ");for(let e=t.length-1;-1<e;--e)t[e]===N&&s.push(e);if(0<s.length)break}for(let e=F.length-1;-1<e;--e)if(r!==F[e]&&N===getComputedStyle(F[e]).getPropertyValue("grid-area").split("/")[0].replace('"',"").trim()){u=F[e];break}}const A=p[0].trim().split(" ").length;if(f){const T=A-f.split(" ").length;0<T&&(f+=" 1fr".repeat(T))}else f="1fr ".repeat(A).trim()}else{if(u="w"==n?r.previousElementSibling||r.nextElementSibling:r.nextElementSibling||r.previousElementSibling,!f){const I=[],R=i.children;for(let e=0,t=R.length;e<t;++e)I.push(R[e].getBoundingClientRect().width);const k=Math.min.apply(null,I).toFixed(2).toString();for(let e=I.length-1;-1<e;--e)I[e]=k===I[e].toFixed(2).toString()?"1fr":(I[e]/k).toFixed(2).toString().replace("0.",".")+"fr";f=I.join(" ")}const B=X.convert(i.children);o.push(B.indexOf(r)),s.push(B.indexOf(u))}(f=f.split(" "))[o[0]]||(o[0]=o[0]%f.length),f[s[0]]||(s[0]=s[0]%f.length);const C=f.length;m?-1!==m.indexOf("px")?x=(C-1)*_:-1!==m.indexOf("em")&&(w=(C-1)*_):y-=(C-1)*_;for(let t=C-1;-1<t;--t){let e=f[t];-1!==e.indexOf("fr")?L+=parseFloat(e):-1!==e.indexOf("%")?y-=parseFloat(e):-1!==e.indexOf("em")?w+=parseFloat(e):-1!==e.indexOf("px")&&(x+=parseFloat(e))}0!==w&&(w=parseFloat(a.getPropertyValue("font-size"))*w);const O=o.length,S=s.length,q=parseFloat((parseFloat(M*y/100)-x-w)/L),P=(d.className=c.className="tb_grid_drag_tooltip",l.classList.add("tb_drag_grid_current"),r.classList.add("tb_element_clicked"),"w"==n?(d.className+=" tb_grid_drag_right_tooltip",c.className+=" tb_grid_drag_left_tooltip"):(d.className+=" tb_grid_drag_left_tooltip",c.className+=" tb_grid_drag_right_tooltip"),r.style.willChange="width",u&&(u.style.willChange="width"),e=>{e.stopImmediatePropagation(),b=requestAnimationFrame(()=>{!1===h&&(h=!0,W.ActionBar.clear(),W.undoManager.start("style"),l.append(d,c));let t=parseInt(e.clientX)-v;if(v=e.clientX,0!==t){"e"==n&&(t*=-1);let e=parseFloat(t/q);if(0!==e){e=parseFloat(e/(O+S));let t=parseFloat(f[o[0]])+e,l=parseFloat(f[s[0]])-e;if(.001<t&&.001<l){t=t.toFixed(3)+"fr",l=l.toFixed(3)+"fr";for(let e=O-1;-1<e;--e)f[o[e]]=t;for(let e=S-1;-1<e;--e)f[s[e]]=l;i.style.setProperty("--col",f.join(" ")),d.textContent=t+" / "+r.offsetWidth+"px",u&&(c.textContent=l+" / "+u.clientWidth+"px")}}}})});l.tfOn("lostpointercapture",function(e){e.stopImmediatePropagation(),this.tfOff("pointermove",P,{passive:!0}),b&&cancelAnimationFrame(b),requestAnimationFrame(()=>{if(d.remove(),c.remove(),W.ActionBar.clear(),r.classList.remove("tb_element_clicked"),this.classList.remove("tb_drag_grid_current"),t.remove("tb_start_animate","tb_drag_grid_start"),r.style.willChange="",u&&(u.style.willChange=""),h){const e=i.closest("[data-cid]");for(let e=f.length-1;-1<e;--e)f[e]=parseFloat(parseFloat(f[e]).toFixed(3).replace("0.",".")).toString()+"fr";W.Registry.get(e.dataset.cid).setCols({size:f.join(" ")}),i.style.setProperty("--col",""),W.Utils.setCompactMode([r,u]),X.trigger("tb_grid_changed",e),W.Utils._onResize(!0),W.undoManager.end("style")}h=b=u=null})},{once:!0,passive:!0}).tfOn("pointermove",P,{passive:!0}).setPointerCapture(e.pointerId),t.add("tb_start_animate","tb_drag_grid_start")}})(jQuery,tb_app,Themify,window.top,document);