((E,S,$,p,k,f,q)=>{"use strict";let I,R,H,X,U,K,o,M,B=k.tfId("tb_inline_editor_root"),g=null,m=null,n=null,_=null,h=null,b=null,y=!1,t=!1,d=!1,r,G=!1,u,P=!1,v=!1,V=!1,l,D,C=-1,W=null,w,N=[];const Y=e=>{let t=e.getBoundingClientRect(),a=0,s=0,i=t.top+p.scrollY,o=t.left+p.scrollX;while(null!==e)a+=e.offsetTop,s+=e.offsetLeft,e=e.offsetParent;return i-=a,o-=s,{top:a,left:s+o,width:t.width,height:t.height,diffTop:i,diffLeft:o}},J=e=>{if(null===W){const t=p.getSelection(),a={el:e};if(N.splice(C+1,N.length-C),0!==t.rangeCount){const s=t.getRangeAt(0).cloneRange();a.r={startOffset:s.startOffset,endOffset:s.endOffset,collapsed:s.collapsed,startContainer:E.Helper.cloneDom(s.startContainer),endContainer:E.Helper.cloneDom(s.endContainer)}}N.push(a),C=N.length-1}},L=(e,...t)=>{const a=t[0]!==q?t[0]:null;k.execCommand("styleWithCSS",!1,!0),k.execCommand(e,!1,a)},i=e=>{const t=k.queryCommandState(e);return-1!==t&&t},T={undo:{result(e,t){W=!0;const a="undo"===(t=t||"undo")?0:1,s=C+a,i=N[s];if("undo"===t?--C:++C,i!==q){if(i.el===I.innerHTML)return void T[t].result(e);let r=i.r;if(I.innerHTML=i.el,r){let e=r.startOffset,t=r.endOffset,a=r.collapsed,s=r.startContainer,i=r.endContainer,o,n,l;const d=p.getSelection(),c=new Range,f=s.nodeType===Node.TEXT_NODE?s.textContent:null,m=i.nodeType===Node.TEXT_NODE?i.textContent:null,u=e=>{if(!o||!n){const t=e.childNodes;for(let e=t.length-1;-1<e;--e){if(o&&n)break;l||t[e].nodeType!==Node.TEXT_NODE||(l=t[e]),!o&&(t[e].isEqualNode(s)||null!==f&&t[e].nodeType===Node.TEXT_NODE&&t[e].textContent===f)&&(o=t[e]),!n&&(t[e].isEqualNode(i)||null!==m&&t[e].nodeType===Node.TEXT_NODE&&t[e].textContent===m)&&(n=t[e]),u(t[e])}}};u(I),d.removeAllRanges(),I.focus(),(o=o||n?o:n=l)&&n&&(c.collapse(a),c.setStart(o,e),c.setEnd(n,t),d.addRange(c))}O()}W=null},state(e,t){const a="redo"===t?C<N.length-1:-1<C;return e&&e.toggleClass("disabled",!a),a}},redo:{result(e){T.undo.result(e,"redo")},state(e){return T.undo.state(e,"redo")}},formatBlock:{result(e){const t=e.parentNode.classList.contains("selected")?"p":e.dataset.action;L("formatBlock","<"+t+">")},state(e){const a=e.tfClass("submenu")[0].tfClass("action"),s=k.queryCommandValue("formatBlock");for(let t=a.length-1;-1<t;--t){let e=a[t].parentNode.classList;s===a[t].dataset.action?e.contains("selected")||(e.add("selected"),ne(a[t])):e.remove("selected")}}},text_align:{result(e){if(e.parentNode.classList.contains("selected")){if(b){if(b.startContainer){b.startContainer.parentNode.style.textAlign="";const t=b.startContainer.parentNode.closest("[style*=text-align]");t&&(t.style.textAlign="")}if(b.commonAncestorContainer){b.commonAncestorContainer.nodeType!==Node.TEXT_NODE&&(b.commonAncestorContainer.style.textAlign="");const a=b.startContainer.parentNode.closest("[style*=text-align]");a&&(a.style.textAlign="")}ie()}}else L(e.dataset.action)},state(e){const a=e.tfClass("submenu")[0].tfClass("action");let s=!1;for(let t=a.length-1;-1<t;--t){let e=a[t].parentNode.classList;a[t].hasAttribute("data-action")&&i(a[t].dataset.action)?(e.contains("selected")||ne(a[t]),s=!0):e.remove("selected")}!1===s&&e.classList.remove("selected")}},list:{result(e){L(e.dataset.action)},state(e){T.text_align.state(e)}},image:{state(e){},result(e){const p=k.createElement("div"),g=k.createElement("hidden");G=!0;let _;g.tfOn("change",async e=>{e.stopImmediatePropagation();const t=_.state().get("selection").first().toJSON(),a=t.id,s=t.title||"",i=t.alt||s;let o=I;if(!y){x();const r='<img src="'+t.url+'" class="tb_inserted_image">';L("insertHTML",r),(o=I.tfClass("tb_inserted_image")[0]).classList.remove("tb_inserted_image"),o.removeAttribute("style")}const n=null!==o.closest("[data-hasEditor]"),l=o.classList;if(y||n){const d=k.createElement("div"),c=o.hasAttribute("data-w")||o.hasAttribute("data-h"),f=!!o.hasAttribute("data-w")&&o.getAttribute("width"),m=!!o.hasAttribute("data-h")&&o.getAttribute("height"),u=async()=>{if(P=!0,Q(!n),y){const e=o.closest(".active_module");await S.trigger("tb_image_resize",[I,R,f,m]),ge(),e&&await E.Utils.runJs(e,"module"),F(),S.requestIdleCallback(()=>{setTimeout(()=>{requestAnimationFrame(F)},25)},500)}else o.click();d.remove()};y&&(d.className="tf_loader tf_abs_c",h.appendChild(d),h.classList.add("tb_image_editor_loading")),o.removeAttribute("srcset"),!n&&c?o.dataset.orig=t.url:(o.removeAttribute("data-orig"),n&&(o.alt=i,o.title=s)),c&&(!n||f||m)||(o.width=t.width,o.height=t.height),!f&&!m||n?(z(),o.tfOn("load",u,{passive:!0,once:!0}).src=t.url):ThemifyImageResize.toBlob(o,f,m).finally(u)}for(let e=l.length-1;-1<e;--e)if(0===l[e].indexOf("wp-image-")){l.remove(l[e]);break}l.add("wp-image-"+a),g.remove(),p.remove(),G=!1},{passive:!0,once:!0}),ThemifyConstructor.mediaFile.browse(p,g,ThemifyConstructor,"image"),p.click(),_=ThemifyConstructor.mediaFile._frames.image;const t=()=>{_.off("close",t),G=!1,setTimeout(()=>{_=null},50)};_.on("close",t)}},link:{state(e){if(b){const t=b.startContainer.parentNode.closest("a"),a=g.classList;t&&t===b.endContainer.parentNode.closest("a")?(n.firstChild.textContent=n.nextElementSibling.href=t.getAttribute("href"),a.add("show_link"),A(),O(!0)):g.classList.contains("show_link")&&(n.firstChild.textContent=n.nextElementSibling.href="",a.remove("show_link"),A(),O(!0))}},result(e){const t=g.tfClass("link_form")[0].cloneNode(!0),a=t.tfClass("link_input")[0],s=t.querySelector("#link_type"),i=b.startContainer.parentNode.closest("a"),o=ThemifyConstructor,n={px:{min:1,max:5e4},"%":{min:1,max:500}},l=(t.querySelector("#lb_w_holder").replaceWith(o.range.render({id:"lb_w",control:!1,units:n},o)),t.querySelector("#lb_h_holder").replaceWith(o.range.render({id:"lb_h",control:!1,units:n},o)),t.querySelector("#lb_w")),r=t.querySelector("#lb_h"),d=t.querySelector("#lb_w_unit"),c=t.querySelector("#lb_h_unit");if(a.value=l.value=r.value="",s.selectedIndex=d.selectedIndex=c.selectedIndex=0,i&&i===b.endContainer.parentNode.closest("a")){let e=i.target;if(a.value=i.getAttribute("href"),(e="_blank"!==e&&i.hasAttribute("data-zoom-config")?"lightbox":e)&&(s.value!==e&&(s.value=e),"lightbox"===e)){const f=i.dataset.zoomConfig.split("|"),m=-1!==f[0].indexOf("%")?"%":"px",u=f[1]&&-1!==f[1].indexOf("%")?"%":"px";parseInt(f[0])!==parseInt(l.value)&&(l.value=parseInt(f[0])),parseInt(f[1])!==parseInt(r.value)&&(r.value=parseInt(f[1])),d.value!==m&&(d.value=m),c.value!==u&&(c.value=u),t.querySelector(".lightbox").classList.remove("tf_hide")}}t.tfOn("focusout change",oe,{passive:!0}).tfOn("submit",oe).querySelector("#link_type").tfOn("change",e=>{const t=e.currentTarget,a=t.closest("form").querySelector(".lightbox");a.classList.toggle("tf_hide","lightbox"!==t.value),x(),A(),O(!0)},{passive:!0}),_.append(ce(),t),g.classList.add("tf_hide","dialog_open","dialog_link","tf_opacity"),t.classList.remove("tf_hide"),x(),A(),O(!0),setTimeout(()=>{a.focus()},100)}},font:{state(e){},result(e){const t=k.createElement("span");let a=k.createDocumentFragment(),s=k.queryCommandValue("fontName");t.className="themify_tooltip",t.textContent="themify_tooltip",a.appendChild(ThemifyConstructor.font_select.render({id:"",control:!1},ThemifyConstructor)),a=a.firstChild,g.classList.add("tf_hide","dialog_open","dialog_font","tf_opacity"),fe(a);const i=a.tfClass("font-family-select")[0];if(S.triggerEvent(i.closest(".tb_font_preview_wrapper"),"tf_init"),i.tfOn("change",function(e){e.stopPropagation(),d=!0,x(),L("fontName",this.value||"inherit"),setTimeout(()=>{ee(),d=!1},10)},{passive:!0}),x(),A(),O(!0),s&&(s=s.replace(/["']/g,""),i.querySelector('[value="'+CSS.escape(s)+'"]'))){i.value=s,a.tfClass("themify-combo-input")[0].value=s;const o=a.tfClass("themify-combo-dropdown")[0],n=o.querySelector('[data-value="'+CSS.escape(s)+'"]');n&&(n.classList.add("themify-combo-selected"),o.style.scrollBehavior="auto",o.scrollTop=n.offsetTop-n.offsetHeight,o.style.scrollBehavior="")}}},unlink:{result(e){x();const t=b?b.startContainer.parentNode.closest("a"):null;if(t&&t===b.endContainer.parentNode.closest("a")){const a=k.createRange(),s=p.getSelection();a.selectNodeContents(t),s.removeAllRanges(),s.addRange(a)}L("unlink"),ee()}},unlinkBack:{result(e){T.unlink.result(e),me()}},color:{result(e){const t=k.createElement("span"),a=e=>{if(d=!0,x(),""===e&&(e="inherit"),L("foreColor",e),"inherit"===e&&b&&b.commonAncestorContainer){const t=b.commonAncestorContainer.querySelectorAll("span[style]");for(let e=t.length-1;-1<e;--e)"inherit"===t[e].style.color&&(t[e].style.color="",t[e].style||(t[e].outerHTML=t[e].innerHTML));ie()}setTimeout(()=>{ee(),d=!1},10)};let s=k.createDocumentFragment(),i=k.queryCommandValue("foreColor");t.className="themify_tooltip",t.textContent="themify_tooltip",s.appendChild(ThemifyConstructor.color.render({id:"",control:!1},ThemifyConstructor)),s=s.firstChild,g.classList.add("tf_hide","dialog_open","dialog_color","tf_opacity"),fe(s);const o=s.tfClass("tfminicolors-input")[0],n=s.tfClass("tfminicolors-swatch")[0],l=s.tfClass("color_opacity")[0];if(i){let e=1;if(-1<i.indexOf("rgb")){e=-1<i.indexOf("rgba")?parseFloat(i.split(",").slice(-1).pop()):1;const r=i.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);i=r&&4===r.length?"#"+("0"+parseInt(r[1],10).toString(16)).slice(-2)+("0"+parseInt(r[2],10).toString(16)).slice(-2)+("0"+parseInt(r[3],10).toString(16)).slice(-2):""}o.value=i,l.value=e}n.click(),o.tfOn("themify_builder_color_picker_change",e=>{e.stopPropagation();const t=e.detail.val;"dialog_content"!==k.activeElement.id&&_.contains(k.activeElement)&&""!==t||a(t)},{passive:!0}).tfOn("change",function(e){e.stopPropagation(),a($(this).tfminicolors("rgbaString"))},{passive:!0}),l.tfOn("change",e=>{P=!0,e.stopPropagation(),S.triggerEvent(o,"change")},{passive:!0}),A(),O(!0)}}},Q=t=>{if(I&&P&&R){const n=E.activeModel===R;let i=!1,e=!t&&y,s=I,o=new Map;if(V=!0,e){const a=s.dataset.w,l=s.dataset.h;if(!a&&!l){if(!(s=s.closest("[data-hasEditor]")))return;e=!1,v=!0}e&&(a&&o.set(a,s.getAttribute("width")),l)&&o.set(l,s.getAttribute("height"))}if(!e){const r=s.dataset.name;if(r){let e="IMG"===s.tagName?s.dataset.orig||s.src:v?s.innerHTML:s.innerText;!1!==(e=H?H.save(R,I,r,e,o,!n):e)&&null!==e&&o.set(r,e)}}if(0!==o.size){let a=s.dataset.repeat;if(a=a&&!isNaN(a)?!1:a){if(!1===(i=!!s.hasAttribute("data-index")&&parseInt(s.dataset.index))){let t=s.closest(".tf_swiper-slide");if(t=(t=t||s.closest("li"))||s.closest(".module-"+R.get("mod_name")+"-item")){const d=t.parentNode.children;for(let e=d.length-1;-1<e;--e)if(d[e]===t){i=e;break}}}if(!1===i)return}if(n){const c=E.LightBox.el,f=a?c.querySelector("#"+a):null;let s;s=a?(ThemifyConstructor.settings[a]===q&&(ThemifyConstructor.settings[a]=[]),ThemifyConstructor.settings[a][i]===q&&(ThemifyConstructor.settings[a][i]={}),ThemifyConstructor.settings[a][i]):ThemifyConstructor.settings;for(let[e,a]of o){s[e]=a;let t;if((t=t||(null!==f?f.querySelectorAll('[data-input-id="'+e+'"]')[i]:c.querySelector(".tb_lb_option#"+e)))&&t.value!=a){t.value=a;let e=t.closest(".tb_uploader_wrapper");if(e)(e=e.querySelector(".tb_media_uploader img"))&&(e.src=a);else if(v&&"undefined"!=typeof tinyMCE&&tinyMCE){const m=tinyMCE.get(t.id);m&&m.setContent(a)}}}}else{const u=R.get("mod_settings")||{};if(a){u[a]===q&&(u[a]=[]),u[a][i]===q&&(u[a][i]={});for(let[e,t]of o)u[a][i][e]=t}else for(let[e,t]of o)u[e]=t;R.set("mod_settings",u)}ge(),e||(-1===C&&w&&(J(w),w=null),J(I.innerHTML))}}},Z=e=>{e.preventDefault()},j=e=>{e.stopImmediatePropagation(),y&&I&&(I.hasAttribute("data-name")||I.closest("[data-hasEditor]"))&&h.contains(e.target)&&!e.target.closest(".image_menu")&&T.image.result()},c=e=>{if(R&&I&&v&&!y){if(!0===e.ctrlKey||!0===e.metaKey){const t=k.activeElement.tagName,a=f.activeElement.tagName,s=e.code;"INPUT"!==t&&"TEXTAREA"!==t&&"INPUT"!==a&&"TEXTAREA"!==a&&("KeyY"===s||"KeyZ"===s&&!0===e.shiftKey?(e.preventDefault(),T.redo.state()&&T.redo.result()):"KeyZ"===s&&(e.preventDefault(),T.undo.state())&&T.undo.result())}}else f.tfOff("keydown",c),k.tfOff("keydown",c)},A=()=>{const e=g.className,t=g.classList,a=(t.add("tf_hidden"),t.remove("tf_hide"),g.getBoundingClientRect());X=a.width+40,U=a.height+30,g.className=e},ee=()=>{const e=p.getSelection();b=!1===e.isCollapsed?e.getRangeAt(0).cloneRange():null},x=()=>{if(!1===t&&b){t=!0,I.focus();const e=p.getSelection();e.removeAllRanges(),e.addRange(b),t=!1}},te=()=>{if(null===g){if(B.classList.contains("tf_hide")){const e=B.firstElementChild,t=k.createDocumentFragment(),a=E.MainPanel.el.getRootNode().querySelector("#module_combine_style").cloneNode(!0),s=k.tfId("tmpl-builder_row_action").content.querySelector("#module_form_fields_style").cloneNode(!0);t.append(E.ToolBar.getBaseCss(),a,s),e&&(B.attachShadow({mode:e.getAttribute("shadowroot")}).appendChild(e.content),e.remove()),B.shadowRoot.prepend(t),B.classList.remove("tf_hide")}g=B.shadowRoot.tfId("toolbar"),m=g.querySelectorAll("[data-type]")}return g},ae=e=>{const t=e.target.closest(".action");if(e.stopPropagation(),t&&"submit"!==t.type){e.preventDefault(),d=!0;const a=t.closest("[data-type]").dataset.type;"expand"!==a?(-1===C&&w&&(J(w),w=null),T[a]!==q&&T[a].result!==q?T[a].result(t):(x(),L(a)),le()):t.classList.contains("disable")||(p.getSelection().removeAllRanges(),R.edit(),z()),d=!1}},se=e=>{const t=e.composedPath()[0];"BUTTON"!==t.tagName&&"SELECT"!==t.tagName&&"INPUT"!==t.tagName&&(e.stopPropagation(),e.preventDefault())},ie=e=>{e&&e.stopPropagation(),I&&(P=!0,Q())},oe=function(e){if(e.stopPropagation(),"submit"===e.type||"focusout"===e.type&&!e.target.classList.contains("tb_range")||"change"===e.type&&e.target.classList.contains("tb_range"))"submit"===e.type&&e.preventDefault();else{const t=this.tfClass("link_input")[0],a=t.value.trim();if(a){P=!0,x();let e=p.getSelection();const s=b?b.startContainer.parentNode.closest("a"):null,i=this,o=i.querySelector("#link_type").value;if(s&&s===b.endContainer.parentNode.closest("a")){const n=k.createRange();n.selectNodeContents(s),e.removeAllRanges(),e.addRange(n)}if(L("createLink",a),ee(),e.anchorNode&&e.anchorNode.parentNode){const l=e.anchorNode.parentNode.closest("a");if(l)if(l.removeAttribute("target"),l.removeAttribute("data-zoom-config"),l.classList.remove("themify_lightbox"),"_blank"===o)l.target=o;else if("lightbox"===o){l.classList.add("themify_lightbox");const r=i.querySelector("#lb_w").value,d=i.querySelector("#lb_h").value,c=i.querySelector("#lb_w_unit").value||"px",f=i.querySelector("#lb_h_unit").value||"px";if(0<r||0<d){let e="|";r&&(e=r+c+e),d&&(e+=d+f),l.dataset.zoomConfig=e}}}}}},ne=e=>{const t=e.parentNode,a=t.parentNode.closest("li");if(t.classList.add("selected"),a){a.classList.add("selected");const s=a.tfClass("action")[0];s!==q&&s.replaceWith(e.cloneNode(!0))}},le=()=>{for(let s=m.length-1;-1<s;--s){let e=m[s],t=e.dataset.type,a="LI"===e.tagName?e:e.parentNode;"expand"===t||"undo"===t||"image"===t||"redo"===t||a.classList.contains("disabled")||(T[t]!==q&&T[t].state!==q?T[t].state(a):a.classList.toggle("selected",i(t)))}},O=n=>{if(null!==g){const l=p.getSelection(),r=g.classList,d=l.isCollapsed;if(m)for(let e=m.length-1;-1<e;--e){let a=m[e],s=a.dataset.type;if("image"!==s&&"expand"!==s){let e="LI"===a.tagName?a:a.parentNode,t="undo"!==s&&"redo"!==s?d:!T[s].state();e.classList.toggle("disabled",t)}}r.contains("tf_hide")&&(A(),r.remove("tf_hide"),requestAnimationFrame(()=>{r.remove("tf_opacity")}));let e;if(!1===d)ee(),e=b,n===q&&le(),M&&(M.contains("tb_editor_start_select")||(B.classList.add("tb_editor_start_select"),M.add("tb_editor_start_select"),f.body.classList.add("tb_editor_start_select")),u&&clearTimeout(u),u=setTimeout(de,500));else{if(b=null,me(),0===l.rangeCount)return;e=l.getRangeAt(0).cloneRange()}let t=e.getBoundingClientRect(),a=(0===t.left&&0===t.top&&(t=I.getBoundingClientRect()),Y(e.startContainer.parentNode)),s=t.left+(t.width-X)/2,i=t.top-U-10-a.diffTop,o=!1===d||!1===V;if(s+X>=S.w&&(s-=X+Math.ceil(s)+p.pageXOffset-S.w-1),!0===V&&!1===o){const c=g.getBoundingClientRect().top;o=c<=0||160<Math.abs(c-i)}!0===o&&(r.toggle("top_viewport",i<=0),i<=0&&(i=t.bottom+10),s<=0&&(s=15),i+=p.pageYOffset,g.style.transform="translate("+s+"px,"+i+"px)")}},re=()=>{null!==I&&!1===t&&!1===d&&k.activeElement===I&&(o&&clearTimeout(o),K=requestAnimationFrame(()=>{o=setTimeout(()=>{null!==I&&!1===t&&!1===d&&k.activeElement===I&&O()},20)}))},de=()=>{M&&M.contains("tb_editor_start_select")&&(f.body.classList.remove("tb_editor_start_select"),M.remove("tb_editor_start_select"),B.classList.remove("tb_editor_start_select")),u&&clearTimeout(u),u=null},ce=()=>{const e=k.createElement("button");return e.type="button",e.className="tf_close",e.title="Back",e.tfOn(S.click,e=>{e.stopImmediatePropagation(),e.preventDefault(),me(),g.classList.add("tf_hide","tf_opacity"),x(),A(),O()},{once:!0}),e},fe=e=>{const t=k.createElement("div"),a=k.createElement("div");t.id="dialog_header",a.id="dialog_content",a.tabIndex="-1",t.appendChild(ce()),a.appendChild(e),_.append(t,a)},me=()=>{if(g){if(g.style.display="none",_&&_.firstChild)while(_.firstChild)_.removeChild(_.lastChild);g.classList.remove("dialog_open","dialog_color","dialog_font","dialog_link","show_link"),g.style.display="",A()}},ue=e=>{if(_e(),null===g&&te(),null===h){h=k.createElement("div");const t=Y(e),a=I.dataset.orig||I.currentSrc.trim(),s=-1===a.indexOf(S.upload_url)&&-1===a.indexOf("blob:")?themifyBuilder.i18n.img_help:null!==I.closest("[data-hasEditor]")&&themifyBuilder.i18n.img_help2,i=["w","s","e","n"],o=k.createElement("div"),n=k.createDocumentFragment();h.id="image_editor",h.className="tf_abs_t",h.style.transform="translate("+t.left+"px,"+t.top+"px)",h.style.width=t.width+"px",h.style.height=t.height+"px",o.className="image_menu";for(let s=i.length-1;-1<s;--s){let e=k.createElement("div"),t=k.createElement("div"),a=k.createElement("div");e.className="image_handler tf_abs_t tb_editor_"+i[s],t.className="image_border tf_abs_t border_"+i[s],a.className="image_tooltip tf_opacity tf_textc tf_abs_t image_tooltip_"+i[s],t.dataset.axis=i[s],e.dataset.axis=i[s],n.append(t,a,e)}!1!==s&&n.appendChild(ThemifyConstructor.help(s)),h.tfOn("pointerdown",pe,{passive:!0}),S.isTouch||h.tfOn("dblclick",j,{passive:!0}),I.classList.add("tb_selected_img"),h.appendChild(n),B.shadowRoot.appendChild(h)}},pe=async function(t){if(1===t.which){const o=t.target;if(t.stopPropagation(),I&&(I.hasAttribute("data-w")||I.hasAttribute("data-h")||I.closest("[data-hasEditor]"))&&(o.classList.contains("image_handler")||o.classList.contains("image_border"))){this.style.willChange="width,height,transform",I.parentNode.style.willChange="contents",I.style.willChange="width,height";let l,r,a,s,d,c,e=I.dataset.maxw,i=null,f=!1;D=D||new ThemifyImageResize(I),e=(e=(e=e&&I.closest(e))||I.closest("[data-hasEditor]"))||I.parentNode;const n=o.dataset.axis,m=o.classList.contains("image_handler"),u=this,p=40,g=40,_=Number.MAX_VALUE,h=I.getBoundingClientRect(),b=parseInt(h.width),y=parseInt(h.height),v=parseFloat(b/y),C=t.clientX,w=t.clientY,N=u.tfClass("image_tooltip"),L=D.isLocal,T=k.createElement("div"),A=e=>{e.stopPropagation(),a=e.clientX,s=e.clientY,!1===f&&(f=!0),l&&cancelAnimationFrame(l),l=requestAnimationFrame(()=>{if(null===I)z();else{let e,t;!0===m?(e="n"===n||"s"===n?C+b-a:b+a-C,t=parseInt(e/v)):"s"===n||"n"===n?(t="s"===n?y+s-w:w+y-s,e=b):(e="w"===n?b+a-C:C+b-a,t=y),e<p?e=p:e>_&&(e=_),t!==q&&t<g&&(t=g),d===e&&c===t||(d=e,c=t,D.resize(e,t).then(e=>{const t=Y(I);u.style.transform="translate("+t.left+"px,"+t.top+"px)",u.style.width=t.width+"px",u.style.height=t.height+"px",N[0].textContent=N[3].textContent=parseInt(e[1])+"px",N[1].textContent=N[2].textContent=parseInt(e[2])+"px",null!==i&&(i.style.width&&(i.style.width=e[1]+"px"),i.style.height)&&(i.style.height=e[2]+"px"),ge()}))}})},x=async function(e){e&&e.stopPropagation(),l&&cancelAnimationFrame(l),r&&clearTimeout(r),this.tfOff("pointermove",A,{passive:!0}).tfOff("lostpointercapture",x,{passive:!0,once:!0}),B.classList.remove("tb_image_editor_resizing");const t=M||k.body.classList;if(t.remove("tb_start_animate","tb_image_editor_resizing"),!(u.style.willChange=I.style.willChange=I.parentNode.style.willChange="")===f){P=!0;let t=I.closest(".active_module,.module_column");Q();const a=I.getAttribute("width"),s=I.getAttribute("height"),i=()=>new Promise(async e=>{await S.trigger("tb_image_resize",[I,R,a,s]),ge(),t&&await E.Utils.runJs(t,"module"),F(),setTimeout(()=>{requestAnimationFrame(F),E.undoManager.has("inline")&&E.undoManager.end("inline"),e()},25)});if(t){const o=t.querySelectorAll('img[data-w="'+I.dataset.w+'"]');if(1<o.length){const n=[];L&&t.classList.add("tf_image_editor_working");for(let t=o.length-1;-1<t;--t)if(o[t]!==I)try{let e=new ThemifyImageResize(o[t]);n.push(e.highQuality(a,s))}catch(e){}try{await Promise.all(n),await i()}catch(e){}t.classList.remove("tf_image_editor_working")}else D.highQuality(a,s),i()}else i()}f=!1,l=r=d=c=filterImage=null};if(B.classList.add("tb_image_editor_resizing"),M.add("tb_start_animate","tb_image_editor_resizing"),T.className="tf_loader tf_abs_c",this.appendChild(T),this.classList.add("image_loading"),!1===D.isLocal){const O=I.closest("[data-hasEditor]")?"img_help2":"img_help";TF_Notification.showHide("warning",themifyBuilder.i18n[O],4e3)}else null!==(i=I.parentNode)&&"FIGURE"!==i.tagName||(i=null);D.lowQuality().then(()=>{!0===D.isBig&&TF_Notification.showHide("warning",themifyBuilder.i18n.img_big.replace("%w",I.naturalWidth).replace("%h",I.naturalHeight),4e3),o.tfOn("pointermove",A,{passive:!0}),u.classList.remove("image_loading"),T.remove(),o.setPointerCapture(t.pointerId)}),o.tfOn("lostpointercapture",x,{passive:!0,once:!0})}}},F=()=>{h&&!M.contains("tb_image_editor_resizing")&&requestAnimationFrame(()=>{h&&I&&!M.contains("tb_image_editor_resizing")&&ue(I)})},ge=()=>{null!==r&&r.update()},_e=()=>{h&&(h.tfOff("pointerdown",pe,{passive:!0}).tfOff("dblclick",j,{passive:!0}).remove(),h=filterImage=null)},z=t=>{if(!(G||t&&1!==t.which)){let e=t?t.target:null;if(!(e&&g&&(1!==t.which||"tb_inline_editor_root"===e.id||g.contains(e)||l&&l.getRootNode().host.contains(e))))if(me(),e&&R&&I&&I.contains(e))t&&I&&!1===p.getSelection().isCollapsed&&(M.contains("tb_editor_start_select")||(B.classList.add("tb_editor_start_select"),M.add("tb_editor_start_select"),f.body.classList.add("tb_editor_start_select")),this.tfOn("pointerup",de,{passive:!0,once:!0}));else{if(K&&cancelAnimationFrame(K),o&&clearTimeout(o),k.tfOff("pointerdown",z,{passive:!0}).tfOff("selectionchange",re,{passive:!0}).tfOff("pointerup",de,{passive:!0,once:!0}).tfOff("keydown",c),f.tfOff("pointerdown",z,{passive:!0}).tfOff("keydown",c),de(),I){I.tfOff("input",ie,{passive:!0}),"IMG"!==I.tagName&&I.setAttribute("contenteditable","false"),I.classList.remove("tb_selected_img");const a=I.closest("form");let e=I.closest("[draggable]");while(null!==e)e.draggable=!0,e=e.parentNode.closest("[draggable]");if(a){const s=a.tfOff("submit",Z).querySelectorAll("[data-required]");for(let e=s.length-1;-1<e;--e)s[e].removeAttribute("data-required"),s[e].setAttribute("required","required")}let t=I;while(t&&t.classList&&!t.classList.contains("active_module"))t.dataset.tmpAnimation&&(t.style.animationName=t.dataset.tmpAnimation,t.removeAttribute("data-tmp-animation")),t=t.parentNode}if(r&&r.params&&r.params.autoplay&&r.params.autoplay.enabled&&(r.el.dataset.stopped=!1,r.autoplay.start(),r.params.thumbs)&&r.params.thumbs.swiper.autoplay&&r.params.thumbs.swiper.autoplay.enabled&&(r.params.thumbs.swiper.el.dataset.stopped=!1,r.params.thumbs.swiper.autoplay.start()),g&&(g.classList.add("tf_hide","tf_opacity"),g.tfOff(S.click,ae).tfOff("pointerdown",se).classList.remove("top_viewport","show_link")),t&&p.getSelection().removeAllRanges(),S.off("tfsmartresize",F).off("tbresizeImageEditor",F).off("tbDisableInline",z),_e(),B.classList.remove("tb_editor_active","tb_editor_image_active","tb_editor_start_select"),M&&M.remove("tb_editor_active","tb_editor_image_active","tb_editor_start_select"),f.body.classList.remove("tb_editor_active","tb_editor_image_active","tb_editor_start_select"),l&&(l.getRootNode().host.classList.add("tf_hide"),l.tfOff("input reset "+S.click,imageEffects,{passive:!0})),I){const i=I.closest(".active_module");if(i&&(i.tfOff("dblclick",j,{passive:!0}).classList.remove("tb_editor_on","tb_editor_clicked"),P)){Q();for(let a=E.LightBox.el.tfClass("CodeMirror"),s=a.length-1;-1<s;--s){let t=a[s].CodeMirror;if(t){let e=a[s].previousElementSibling;e&&(t.setValue(e.value),setTimeout(()=>{t.refresh()},10))}}I.hasAttribute("data-no-update")||E.Utils.runJs(i,"module")}}S.trigger("inlineEditorDisable",[R,I]),I&&E.undoManager.has("inline")&&E.undoManager.end("inline"),E.undoManager.clear("inline"),E.undoManager.enable(),N=[],C=-1,g=W=w=l=D=M=o=K=v=H=b=X=U=K=m=_=n=R=r=I=null}}};S.on("themify_builder_ready",()=>{let l=!1;E.Builder.get().el.tfOn("pointerdown",e=>{if((l=V=!1)!==E.isPreview||!0!==E.inlineEditor||1!==e.which||e.ctrlKey||e.metaKey)z();else{const a=(y="IMG"===e.target.tagName)?e.target:e.target.closest("[contenteditable]");if(a&&!a.closest(".tb_disable_sorting")&&(y||!1===a.contentEditable||"false"===a.contentEditable)){de(),p.getSelection().removeAllRanges();const s=a.closest(".active_module");if(s){const i=E.Registry.get(s.dataset.cid);if(!i||i.get("mod_settings").__dc__!==q&&i.get("mod_settings").__dc__[a.dataset.name]!==q)return void z();s.classList.add("tb_editor_clicked")}y||(a.contentEditable=!0);let t=[],e=a.closest("[draggable]");while(null!==e)t.push(e),null!==e.parentNode&&(e=e.parentNode.closest("[draggable]"));if(0<t.length){const o=e=>{k.tfOff("pointermove",n,{passive:!0,once:!0});for(let e=t.length-1;-1<e;--e)t[e].tfOff("drag",n,{passive:!0,once:!0}).draggable=!1},n=e=>{k.tfOff("pointermove",n,{passive:!0,once:!0}),a.tfOff("pointerup",o,{passive:!0,once:!0}).setAttribute("contenteditable",!1),s&&s.classList.remove("tb_editor_clicked");for(let e=t.length-1;-1<e;--e)t[e].tfOff("drag",n,{passive:!0,once:!0});_e(),"drag"===e.type&&z()};a.tfOn("pointerup",o,{passive:!0,once:!0}),k.tfOn("pointermove",n,{passive:!0,once:!0});for(let e=t.length-1;-1<e;--e)t[e].tfOn("drag",n,{passive:!0,once:!0})}l=!0}}},{passive:!0}).tfOn(S.click,e=>{if(l){let t=e.target;if(t.hasAttribute("data-target")){let e=t.closest(".active_module");(e=e&&e.querySelector(t.dataset.target))&&(t=e)}const s=(y="IMG"===t.tagName)?t:t.closest("[contentEditable]");if(s){if(s.closest("label,a,button")&&e.preventDefault(),I!==s)if(1===e.which&&(!y||s.dataset.w||s.dataset.h||s.dataset.name||s.closest("[data-hasEditor]"))){const i=s.closest(".active_module");if(i){if(z(),R=E.Registry.get(i.dataset.cid),!y){let a=R.get("mod_name").split("-"),s=a[0];for(let e=1,t=a.length;e<t;++e)s+=a[e].charAt(0).toUpperCase()+a[e].slice(1);H=E.BaseInLineEdit.items.get(s)}E.activeModel&&R.id===E.activeModel.el||E.undoManager.start("inline",i),E.undoManager.disable(),P=!1,I=s,M=k.body.classList,de(),B.classList.add("tb_editor_active"),M.add("tb_editor_active"),f.body.classList.add("tb_editor_active"),v=!y&&s.hasAttribute("data-hasEditor"),i.classList.add("tb_editor_on"),i.classList.remove("tb_editor_clicked");let e=I,t=s.closest("form"),a=s.closest("[draggable]");if(t){const o=t.tfOn("submit",Z).querySelectorAll("[required]");for(let e=o.length-1;-1<e;--e)o[e].removeAttribute("required"),o[e].dataset.required=1}while(e&&e!==i)e.style.animationName&&(e.dataset.tmpAnimation=e.style.animationName,e.style.animationName="none"),e=e.parentNode;while(null!==a)a.draggable=!1,a=a.parentNode.closest("[draggable]");e=a=t=null,(r=(r=I.closest(".tf_swiper-container"))&&r.swiper?r.swiper:null)&&r.params&&r.params.autoplay&&r.params.autoplay.enabled&&(r.el.dataset.stopped=!0,r.autoplay.stop(),r.params.thumbs)&&r.params.thumbs.swiper&&r.params.thumbs.swiper.autoplay&&r.params.thumbs.swiper.autoplay.enabled&&(r.params.thumbs.swiper.el.dataset.stopped=!0,r.params.thumbs.swiper.autoplay.stop()),y?(M.add("tb_editor_image_active"),f.body.classList.add("tb_editor_image_active"),B.classList.add("tb_editor_image_active"),S.on("tfsmartresize",F).on("tbresizeImageEditor",F)):(I.contentEditable=!0,w=I.innerHTML,I.tfOn("input",ie,{passive:!0}).focus(),S.isTouch||setTimeout(()=>{i&&(i.tfOff("dblclick",j,{passive:!0}).tfOn("dblclick",j,{passive:!0}),themifyBuilder.disableShortcuts||(f.tfOn("keydown",c),k.tfOn("keydown",c)))},800)),S.on("tbDisableInline",z),k.tfOn("pointerdown",z,{passive:!0}),f.tfOn("pointerdown",z,{passive:!0}),v?(k.tfOn("selectionchange",re,{passive:!0}),te(),A(),g.tfOn(S.click,ae).tfOn("pointerdown",se),n=g.querySelector("#link_btn"),_=g.querySelector("#dialog"),setTimeout(()=>{requestAnimationFrame(O),g.querySelector(".expand").classList.toggle("tf_hide",E.activeModel===R)},30)):y&&(s.closest(".masonry")?S.requestIdleCallback(()=>{setTimeout(()=>{requestAnimationFrame(()=>{ue(s)})},25)},500):ue(s))}else z()}else z()}else z()}})},!0,E.is_builder_ready).on("disableInline",z),E.BaseInLineEdit=class{constructor(){E.BaseInLineEdit.items.set(this.constructor.name,this)}},E.BaseInLineEdit.items=new Map})(tb_app,Themify,jQuery,window,document,window.top.document,void 0);