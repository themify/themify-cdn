var PTB_Submission_Map=()=>{"use strict";var r,$=jQuery;function d(e,o,t,n){r.geocode({latLng:{lat:"function"==typeof e.lat?e.lat():e.lat,lng:"function"==typeof e.lng?e.lng():e.lng}},function(e){e&&0<e.length?(o.setContent(e[0].formatted_address),o.open(t,n)):(o.close(),o.setContent(""))})}function m(e,o,t){e.val(JSON.stringify({place:o,location:{lat:t.lat(),lng:t.lng()}}))}$(".ptb_extras_submission_map").each(function(){!function(t){r=r||new google.maps.Geocoder;var e={center:new google.maps.LatLng(43.67023,-79.38676),zoom:13,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}},o=document.getElementById("ptb_extra_"+t+"_canvas"),n=new google.maps.Map(o,e),a=document.getElementById("ptb_extra_"+t+"_location"),s=new google.maps.places.Autocomplete(a),l=!1,i=$("#ptb_extra_"+t+"_place"),g=i.val(),c=new google.maps.InfoWindow({maxWidth:300}),p=new google.maps.Marker({map:n,draggable:!0,position:e.center,animation:google.maps.Animation.DROP,anchorPoint:new google.maps.Point(0,-29)});s.bindTo("bounds",n),p.setVisible(!0),g?(g=$.parseJSON(g))&&(g.location?(e={lat:g.location.lat||g.location[0],lng:g.location.lng||g.location[1]},p.setPosition(e),n.setCenter(e),d(e,c,n,p)):g.place&&new google.maps.places.PlacesService(n).getDetails({placeId:g.place},function(e,o){o===google.maps.places.PlacesServiceStatus.OK&&(l=e,google.maps.event.trigger(s,"place_changed",t),e.formatted_address?$(a).val(e.formatted_address):$(a).val(e.name))})):$(o).data("default")&&r.geocode({address:$(o).data("default")},function(e,o){var t;"OK"===o&&e[0]&&(t={lat:(o=e[0].geometry.location).lat(),lng:o.lng()},p.setPosition(t),n.setCenter(t),c.setContent(e[0].formatted_address),c.open(n,p),m(i,"",o),$(a).val(e[0].formatted_address))}),google.maps.event.addListener(n,"click",function(e){p.setPosition(e.latLng),d(e.latLng,c,n,p),m(i,"",e.latLng)}),google.maps.event.addListener(p,"dragstart",function(){c.close()}),google.maps.event.addListener(p,"dragend",function(){var e=p.getPosition();d(e,c,n,p),m(i,"",e)}),google.maps.event.addListener(p,"click",function(){c.open(n,p)}),google.maps.event.addListener(s,"place_changed",function(){c.close();var e="";if(l){var o=l;l=!1}else if(!(o=s.getPlace())||!o.geometry)return void alert("Autocomplete's returned place contains no geometry");o.geometry.viewport?n.fitBounds(o.geometry.viewport):(n.setCenter(o.geometry.location),n.setZoom(17)),p.setIcon({url:o.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),p.setPosition(o.geometry.location),p.setVisible(!0),!l&&o.address_components&&(e=[o.address_components[0]&&o.address_components[0].short_name||"",o.address_components[1]&&o.address_components[1].short_name||"",o.address_components[2]&&o.address_components[2].short_name||""].join(" "),e="<div><strong>"+o.name+"</strong><br>"+e),c.setContent(e),c.open(n,p),m(i,o.place_id,o.geometry.location)})}($(this).data("id"))})};($=>{"use strict";window.addEventListener("load",function(){"object"!=typeof google||"object"!=typeof google.maps||void 0===google.maps.places?("object"==typeof google&&null!==google&&"object"==typeof google.maps&&void 0===google.maps.places&&(google.maps=null),function(e,o){var t=document.createElement("script");t.type="text/javascript",t.async="async",o&&(t.onload=o),document.getElementsByTagName("head")[0].appendChild(t),t.src=e}("//maps.googleapis.com/maps/api/js?v=3.exp&signed_in=false&sensor=false&libraries=places&callback=PTB_Submission_Map&language="+ptb_submission.lng+"&key="+ptb.map_key)):PTB_Submission_Map()},{once:!0,passive:!0}),$(document).on("ptb_submission_validate",function(e,o){if(0<(o=$(this)).closest(".ptb_extra_submission_map_control").length)return o.is(":hidden")&&!$.trim(o.val())})})(jQuery);