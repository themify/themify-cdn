!function($){"use strict";var l={},u={};var r=function(t){t.each(function(){var t=0<(t=$(this).closest(".ptb-submission-text-option")).length?t:$(this).closest(".ptb_module"),i=d(),i=(t.find("label").prop("for",i),$(this).prop("id",i),$(this).closest("form")),e=$(this).data("extension")?new RegExp("(\\.|/)("+$(this).data("extension")+")$","i"):/(\.|\/)(gif|jpe?g|png)$/i,s=$(this).data("size"),n=$(this).data("width"),o=$(this).data("height"),r=t.find(".ptb-submission-priview"),p=$(this);$(this).fileupload({url:i.attr("action"),type:"POST",acceptFileTypes:e,maxFileSize:s,dataType:"json",singleFileUploads:!0,autoUpload:!1,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),previewMaxWidth:n||100,previewMaxHeight:o||100,previewCrop:!0}).on("fileuploadprocessalways",function(t,i){var e=i.index,s=i.files[e],n=$('.ptb-submission-upload-btn[for="'+p.attr("id")+'"]');if(r.next(".ptb-submission-file-danger").remove(),r.hide("blind",500,function(){s.error?(n.html(p.data("label")),$(this).after($('<span class="ptb-submission-file-danger ptb-submission-error-text"/>').text(s.error))):(s.preview?($(this).html(s.preview),0===$(this).closest(".ptb-submission-multi-text").length&&0===$(this).closest(".ptb-submission-module-req").length&&$(this).append('<span data-slug="'+p.attr("id")+'" class="ptb-submission-file-remove"></span>'),$(this).append('<span class="ptb-submission-file-name">'+s.name+"</span>").append('<span class="ptb-submission-file-size">'+function(t){var i=+Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,i)).toFixed(i?1:0)+" "+["n/a","B","KB","MB"][isNaN(t)?0:1+i]}(s.size)+"</span>").width(i.previewMaxWidth).show("blind",500)):$(this).html(""),n[0].childNodes[1].textContent=12<s.name.length?s.name.substring(0,12)+"...":s.name)}),!s.error)for(var o=0;o<i.files.length;o++){var a=$(this).attr("id");l[a]=i.files[o],u[a]=t.delegateTarget.name}})})},n=function(t,i,e){e.hide("blind",500,function(){$(this).empty()}),delete u[i],delete l[i],t.html(t.html());e=$('.ptb-submission-upload-btn[for="'+i+'"');e.html(e.data("label")),r(t.find(".ptb-submission-file"))},d=function(){return"ptb_submission_"+Math.random().toString(36).substr(2,9)},p=function(t,i){var e,s=i.find(".ptb-submission-errors"),n=i.find(".ptb-submission-form-error");if(s.html(""),i.find(".ptb-submission-error-text").remove(),t)if(t.success)t.r?window.location.href=t.success:(e=window.location.search?window.location.href+"&":window.location.href+"?",e+="nonce="+t.nonce+"&form_id="+t.form_id,window.location.href=e);else if(t.fee)window.location.href=t.fee;else{var o,a,r,p=!1;for(o in t){if("captcha"===o){if("undefined"!=typeof grecaptcha&&0<i.find(".ptb-submission-google").length){grecaptcha.reset(),p=!0,i.find(".ptb-submission-google").append('<div class="ptb-submission-error-text">'+t[o]+"</div>");continue}i.find(".ptb-submission-captcha-refresh").trigger("click")}for(r in"object"!=typeof t[o]&&(a=t[o],t[o]=[1]),t[o]){var l=i.find('[name^="submission['+o+']"]'),u=0!==r&&1!==t[o][r]?t[o][r]:a;0<(l=0===l.length?i.find('[name^="'+o+'"]'):l).length?(l.addClass("ptb-submission-required-error").closest(".ptb_module").addClass("ptb-submission-label-required"),l.first().closest(".ptb_back_active_module_input").append('<div class="ptb-submission-error-text">'+u+"</div>")):s.append("<div>"+u+"</div>")}}!1===p&&"undefined"!=typeof grecaptcha&&0<i.find(".ptb-submission-google").length&&grecaptcha.reset(),n.html(ptb_submission.errors)}},e=function(){$(".ptb-submission-multi-text>ul").sortable({placeholder:"ui-state-highlight",handle:".ptb-submission-option-sort"})};$(document).on("ptb_loaded",function(t,i){0<$(".ptb_lightbox_add_tax").length&&($(".mfp-wrap").addClass("ptb_lightbox_add_tax_wrapper").find('input[type="text"], textarea').each(function(){var t=$(this).attr("name");t&&$(this).attr("name",t+"[]")}),e(),function(){$("form.add_temp_tax").submit(function(t){t.preventDefault();var i=$(this),t=i.find('input[type="text"]'),e=!1,s=0<$(this).find(".ptb_language_tabs").length;if(i.find(".ptb-submission-error-text").remove(),i.find(".ptb-submission-required-error").removeClass("ptb-submission-required-error"),t.each(function(){var t;$.trim($(this).val())||(s&&0===(t=$(this).closest(".ptb_back_active_module_input")).find(".ptb-submission-error-text").length&&t.append('<span class="ptb-submission-error-text">'+ptb_submission.tax_all_errors+"<span>"),e=!0,$(this).attr("placeholder",ptb_submission.tax_error).addClass("ptb-submission-required-error"))}),e)return!1;$.ajax({url:i.prop("action"),data:i.serialize(),type:"POST",dataType:"json",beforeSend:function(){i.addClass("ptb-submission-wait")}}).always(function(){i.removeClass("ptb-submission-wait"),$(".mfp-container").trigger("click")}).done(function(t){if(t&&t.slug){var i,e=$("a#ptb_submission_lightbox_"+t.slug),s=e.closest(".ptb_back_active_module_input"),n=0<s.find("select").length,o=!n&&(0<s.find("input:radio").length||0<s.find("input:checkbox").length),a=!n&&!o&&0<s.find(".ptb-submission-autocomplete").length;if(t.exists)for(var r in t.exists)n?((i=s.find("select")).prop("multiple")||i.find("option:selected").prop("selected",!1),i.find('option[value="'+r+'"]').prop("selected",!0)):o?s.find("#ptb_tax_"+r).prop("checked",!0):a&&(s.find('input[type="text"]').val(t.exists[r].title),s.find('input[type="text"]').next("input").val(r));if(t.add){var p,l=$.uniqueSort(t.add[t.lng]),u=o&&(0<s.find("input:radio").length?"radio":"checkbox");for(r in l)n?(p=s.find('option[value="'+l[r].slug+'"]'),s.find("select").prop("multiple")||s.find("option").removeAttr("selected"),0<p.length?p.prop("selected",!0):s.find("select").prepend('<option value="'+l[r].slug+'" selected="selected">'+l[r].value+"</option>")):o?("radio"===u&&s.find("input").prop("checked",!1),0<(p=s.find('input[value="'+l[r].slug+'"]')).length?p.find("input").prop("checked","checked"):s.prepend('<label class="ptb-submission-new-item"><input name="'+s.find("input[name]").first().prop("name")+'" value="'+l[r].slug+'" type="'+u+'" checked="checked" /><span>'+l[r].value+"</span></label>")):a&&(s.find('input[type="text"]').val(l[r].value),s.find('input[type="text"]').next("input").val(l[r].slug));var d,b={};for(d in t.add)for(var c in b[d]=[],t.add[d])b[d].push([t.add[d][c].value,t.add[d][c].desc]);var e=e.next("input"),f=e.val();for(r in f=f?JSON.parse(f):[])for(var h in f[r])b[r].push(f[r][h]);e.val(JSON.stringify(b))}n?s.find("select").trigger("chosen:updated").next(".chosen-container").find("a,ul").effect("highlight",{},2e3):$(".ptb-submission-new-item").effect("highlight",{},2e3).removeClass("ptb-submission-new-item")}})})}())}),$(window).on("load",function(){!function(){$(document).on("click",".ptb_language_tabs li",function(t){var i;t.preventDefault(),$(this).hasClass("ptb_active_tab_lng")||(i=(t=$(this).closest("ul")).next("ul"),t.find(".ptb_active_tab_lng").removeClass("ptb_active_tab_lng"),$(this).addClass("ptb_active_tab_lng"),i.find(".ptb_active_lng").removeClass("ptb_active_lng"),i.find("li").eq($(this).index()).addClass("ptb_active_lng"))})}(),r($('input[type="file"].ptb-submission-file')),function(){$("body").on("click",".ptb_module .ptb-submission-file-remove",function(t){t.preventDefault();var t=$(this).closest(".ptb-submission-priview"),i=t.find(".ptb-submission-file-wrap"),e=$(this).data("slug");n(i,e,t)})}(),function(){var t=$(".ptb-submission-autocomplete"),o=[];t.each(function(){var s=$(this).data("slug"),e=$(this),n=$(this).data("post_type");o[s]={},$(this).autocomplete({minLength:2,source:function(t,i){var e=t.term;e in o[s]?i(o[s][e]):$.ajax({url:ptb.ajaxurl,dataType:"json",type:"POST",data:{term:t.term,slug:s,post_type:n,action:"ptb_submission_terms"}}).done(function(t){o[s][e]=t,i(t)})},focus:function(t,i){t.preventDefault()},open(){$("ul.ui-menu").width($(this).innerWidth())},select(t,i){return e.val(i.item.label),e.next("input").val(i.item.value),!1}})})}(),function(){function o(t){return t.split(/,\s*/)}function a(t){return o(t).pop()}var r,t=$(".ptb_post_tag");0<t.length&&(r=[],t.each(function(){var t=$(this).find('input[type="text"]'),n=$(this).closest("form").children('input[name="post_type"]').val(),i=/.*?\[.*?\]\[(.+?)\]$/;t.each(function(){var s=$(this).prop("name").match(i);if(0===s.length||!s[1])return!1;s=s[1],r[s]={},$(this).autocomplete({minLength:2,source:function(t,i){var e=t.term;e in r[s]?i(r[s][e]):$.ajax({url:ptb.ajaxurl,dataType:"json",type:"POST",data:{term:a(t.term),slug:s,post_type:n,action:"ptb_submission_tag_terms"}}).done(function(t){r[s][e]=t,i(t)})},focus:function(t,i){t.preventDefault()},open:function(){$("ul.ui-menu").width($(this).innerWidth())},select:function(t,i){var e=o(this.value);return-1===$.inArray(i.item.label,e)?(e.pop(),e.push(i.item.label),e.push("")):(i=e.indexOf(a(this.value)),e[i]=null),this.value=e.join(", "),!1}})})}))}(),function(){$(".ptb-select").chosen({disable_search_threshold:7,search_contains:!0,width:"100%"})}(),function(){$(".ptb-submission-text-option input,.ptb-submission-text-option textarea").each(function(){var t=$(this).attr("name");t&&$(this).attr("name",t+"[]")}),$(".ptb-submission-multi-text li").each(function(){var t;0<$(this).find(".ptb-submission-priview").length&&(t=d(),$(this).find("label").prop("for",t),$(this).find('input[type="file"]').prop("id",t))}),$("body").on("click",".ptb-submission-option-add",function(t){t.preventDefault(),t.stopPropagation();var t=$(this).closest(".ptb-submission-multi-text"),i=t.data("max"),e=t.find(".ptb-submission-text-option").length;if(!(i&&i<=e)){var s=t.find(".ptb-submission-text-option").first().clone(),t=t.children("ul"),n=(s.find("input,textarea").val(""),s.find(".ptb-submission-required-error").removeClass("ptb-submission-required-error"),s.find(".ptb-submission-priview"));if($.event.trigger("ptb_submission_before_option_add",s),0<n.length){var o=d();s.find(".ptb-submission-error-text").remove();const a=s.find("label");a.prop("for",o),a[0].childNodes[1].textContent=a[0].dataset.label,s.find('input[type="file"]').prop("id",o),n.empty().hide()}s.appendTo(t).hide().show("blind",500),0<n.length&&r($("#"+o)),$.event.trigger("ptb_submission_after_option_add",s),t.sortable("refresh"),i&&i<=e+1&&$(this).fadeOut()}}).on("click",".ptb-submission-remove",function(t){t.preventDefault(),t.stopPropagation();var t=$(this).closest(".ptb-submission-text-option"),i=t.find(".ptb-submission-priview");if(0<i.length&&(s=(e=i.closest(".ptb-submission-text-option").find(".ptb-submission-file-wrap")).find("input").attr("id"),n(e,s,i)),1===t.closest("ul").children("li").length)return t.find("input").val(""),!1;var e=$(this).closest(".ptb-submission-multi-text"),s=e.data("max"),i=e.find(".ptb-submission-text-option").length;s&&i-1<s&&e.find(".ptb-submission-option-add").fadeIn(),t.hide("blind",500,function(){$(this).remove()})}),e()}(),function(){$(".ptb-submission-captcha-refresh").click(function(t){t.preventDefault();var i=$(this).closest("form"),t=$(this).closest("table").find("img");i.addClass("ptb-submission-wait"),t.attr("src",t.attr("src")).on("load",function(){i.removeClass("ptb-submission-wait")})})}(),function(){$("body").on("focusout",".ptb_number input",function(){var t=parseFloat($(this).prop("min")),i=parseFloat($(this).prop("max")),e=parseFloat($(this).val());e<t?$(this).val(t):i<e&&$(this).val(i),$(this).hasClass("ptb_number_min")?(i=parseFloat($(this).closest(".ptb_module").find(".ptb_number_max").val()))<=e&&$(this).val(i-1):$(this).hasClass("ptb_number_max")&&e<=(t=parseFloat($(this).closest(".ptb_module").find(".ptb_number_min").val()))&&$(this).val(t+1)})}(),function(){$("body").on("submit",".ptb-submission-form",function(t){t.preventDefault();var i=$(this),o=!0,t=i.find(".ptb-submission-module-req"),e=i.find(".ptb-submission-form-error");if(i.find(".ptb-submission-required-error,.ptb-submission-label-required").removeClass("ptb-submission-required-error ptb-submission-label-required"),i.find(".switch-html").trigger("click"),t.each(function(){var n=$(this);n.find('input:not([type="hidden"]),select,textarea').each(function(){var t=!1,i=$(this).prop("name");if(!i)return!1;var e=$(this).closest(".ptb_module");if($(this).is(":checkbox")||$(this).is(":radio")){if(0<n.find('[name^="'+i+'"]:checked').length)return!1;t=!0}else if(!$.trim($(this).val())&&0==$(this).closest(".chosen-container").length){if($.trim(e.find(".ptb-submission-priview").html()))return!1;t=!0}var i=e.data("type"),s=$.event.trigger("ptb_submission_validate_"+i,[$(this),l]);(t=void 0!==s?s:t)&&(o=("captcha"===i&&e.hasClass("ptb-submission-google")?e.addClass("ptb-submission-required-error"):($(this).addClass("ptb-submission-required-error"),n.addClass("ptb-submission-label-required")),!1))})}),o)if(e.html(""),0<Object.keys(l).length){var s,n,a=[],r=[],t=$(".ptb-submission-multi-text");for(s in 0<t.length&&t.find(">ul>li").each(function(){var t=$(this).find("input,textarea"),i=$(this).index();t.each(function(){var t=$(this).prop("name");t&&(t=t.replace(/\[[0-9]*\]/i,"["+i+"]"),$(this).prop("name",t))})}),l)i.find("#"+s).length<=0||(0<$("#"+s).closest(".ptb-submission-multi-text").length&&(n=$("#"+s).closest("li").index(),u[s]=u[s].replace(/\[[0-9]*\]/i,"["+n+"]")),r.push(u[s]),a.push(l[s]));i.addClass("ptb-submission-wait"),$(".ptb-submission-file",i).fileupload("send",{files:a,paramName:r}).always(function(){i.removeClass("ptb-submission-wait")}).done(function(t){p(t,i)})}else $.ajax({url:i.attr("action"),type:"POST",dataType:"json",data:i.serialize(),beforeSend:function(){i.addClass("ptb-submission-wait")}}).always(function(){i.removeClass("ptb-submission-wait")}).done(function(t){p(t,i)});else e.html(ptb_submission.errors)})}(),$("form.ptb-submission-form").each(function(){$(this).find(".ptb-submission-priview").each(function(){0<$(this).children("*").length&&$(this).show()})})})}(jQuery);